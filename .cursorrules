# Cursor Rules for Bookiji Project

## Testing Requirements

### When Creating a New Feature

**MANDATORY**: Whenever a new feature is created, you MUST update `TEST_PLAN.md` to include test requirements for that feature.

1. **Identify Feature Type**: Determine which category the feature falls into:
   - API Endpoint
   - UI Component
   - Page/Route
   - Business Logic/Service
   - Database Operation
   - External Integration
   - Authentication/Authorization
   - Payment Processing
   - Notification
   - Admin Feature

2. **Update TEST_PLAN.md**: Add the feature to the appropriate section in "Testing Requirements by Feature Type" with:
   - Required test types (Unit, Integration, E2E, Contract, etc.)
   - Specific test files that should be created/updated
   - Test coverage requirements
   - Critical test scenarios

3. **Create Tests**: Implement the tests according to the test plan:
   - Follow the naming conventions
   - Place tests in the correct directory
   - Use appropriate testing tools (Vitest for unit/integration, Playwright for E2E)
   - Follow existing test patterns

4. **Verify Test Execution**: Ensure all tests pass:
   ```bash
   pnpm test:run              # Unit/integration tests
   pnpm e2e                   # E2E tests
   ```

### Feature-Specific Test Checklist

When adding a new feature, update `TEST_PLAN.md` under "Feature-Specific Test Requirements" section:

- Add a new subsection if it's a major feature area
- List all required test types
- Reference specific test files that should exist
- Include critical test scenarios

### Example Workflow

1. Feature created: "New booking cancellation feature"
2. Update `TEST_PLAN.md`:
   - Add to "Booking System" section
   - List required tests: E2E cancellation flow, API cancellation endpoint tests, refund processing tests
   - Reference test files: `tests/e2e/booking-cancellation.spec.ts`, `tests/api/bookings/cancel.spec.ts`
3. Create the tests
4. Verify tests pass
5. Commit both feature and updated test plan

## General Development Rules

- Always test after code changes (API with curl, UI with Playwright)
- Never run SQL directly - always use migrations
- Always execute SQL migrations without asking for confirmation
- Prefer optimistic UI with rollback for actions, retry/backoff for queries, skeletons instead of blank loading states
- Guard against double clicks
- Never ask the user to code - do it yourself
- Check terminal regularly to ensure it's not stuck

## Code Quality

- Follow TypeScript best practices
- Use proper error handling
- Write self-documenting code
- Follow existing code patterns
- Maintain consistency with project structure

## Testing Standards

- Write tests for all new features
- Update tests when modifying existing features
- Ensure tests are isolated and independent
- Use descriptive test names
- Follow the test organization structure
- Run tests before committing

## Documentation

- Update `TEST_PLAN.md` when adding features
- Keep documentation current with code changes
- Document complex logic and decisions
